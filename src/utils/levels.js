// src/utils/levels.js

// الصيغ العربية الموحَّدة المعتمدة في قاعدة البيانات
export const LEVELS_AR = [
  'الصف الاول الثانوي',
  'الصف الثاني الثانوي',
  'الصف الثالث الثانوي',
];

// تحويل الأرقام العربية إلى إنجليزية لزيادة التحمل
function normalizeDigits(s) {
  const ar = '٠١٢٣٤٥٦٧٨٩';
  const en = '0123456789';
  return s.replace(/[٠-٩]/g, (d) => en[ar.indexOf(d)]);
}

// كل المدخلات المحتملة -> index في LEVELS_AR
const MAP = new Map([
  // أولى
  ['1', 0], ['01', 0], ['اولى', 0], ['أولى', 0], ['اولي', 0],
  ['الاول', 0], ['الأول', 0],
  ['الاول الثانوي', 0], ['الأول الثانوي', 0],
  ['الصف الاول الثانوي', 0], ['الصف الأول الثانوي', 0],
  ['first', 0], ['grade1', 0],

  // تانية
  ['2', 1], ['02', 1], ['تانية', 1], ['ثانية', 1],
  ['التاني', 1], ['الثاني', 1],
  ['الثاني الثانوي', 1], ['التاني الثانوي', 1],
  ['الصف الثاني الثانوي', 1],
  ['الصف التاني الثانوي', 1], // ← إضافة لتغطية المثال العامّي
  ['second', 1], ['grade2', 1],

  // تالتة / ثالثة
  ['3', 2], ['03', 2], ['تالتة', 2], ['ثالثة', 2],
  ['التالت', 2], ['الثالث', 2],
  ['الصف الثالث الثانوي', 2], ['الصف التالت الثانوي', 2],
  ['third', 2], ['grade3', 2],
]);

/**
 * أمثلة (محدّثة لتطابق LEVELS_AR):
 * normalizeLevel('ثالثة') -> 'الصف الثالث الثانوي'
 * normalizeLevel('الصف الثالث الثانوي') -> 'الصف الثالث الثانوي'
 * normalizeLevel('الصف التاني الثانوي') -> 'الصف الثاني الثانوي'
 */
export function normalizeLevel(input) {
  if (input == null) return null;

  // لو المدخل سبق وكان من القيم الموحَّدة
  if (LEVELS_AR.includes(input)) return input;

  // تنظيف عام: trim + lowercase + تحويل أرقام عربية
  const s = normalizeDigits(String(input).trim().toLowerCase());

  const idx = MAP.get(s);
  return (idx === 0 || idx === 1 || idx === 2) ? LEVELS_AR[idx] : null;
}
